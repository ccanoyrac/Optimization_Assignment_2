# README – Stochastic Fuel Procurement and Power Generation Optimization  
Weekly Risk-Aware Scheduling with CVaR and Multi-Technology Fuel Price Scenarios

---

## 1. Overview

This project develops a stochastic optimization model for a thermal power plant operating with three generation technologies:

- Oil  
- Gas  
- Coal  

The plant must satisfy hourly electricity demand over a 7-day horizon while making daily fuel purchasing decisions under uncertainty. Fuel is bought in separate supplier markets with technology-specific daily auctions. Electricity is sold hour-by-hour in the electricity market.

Key objectives:

- Optimize daily fuel purchases.  
- Determine hourly generation schedules for each scenario.  
- Manage inventories subject to storage costs and capacity.  
- Maximize expected profit.  
- Control risk exposure through Conditional Value-at-Risk (CVaR).  
- Infer endogenous willingness-to-pay (WTP) fuel price limits via shadow prices.  

This README documents the data structure, optimization formulation, scenario design, and interpretation of results.

---

## 2. Data Input Structure (`data_draft_3.json`)

All model parameters are specified externally in a single JSON file. Inputs include:

### 2.1 Technologies

```
"technologies": ["Oil", "Gas", "Coal"]
```

Each technology includes:

- `max_gen_MWh_per_hour` — hourly generation capacity  
- `storage_capacity_MWh` — maximum stored fuel  
- `storage_rent_EUR_per_MWh_per_day` — inventory cost  
- `initial_inventory_MWh`  

---

### 2.2 Fuel Market: Daily Auctions

Fuel is purchased daily from multiple suppliers per technology. Each supplier defines:

```
"price_EUR_per_MWh": {
  "Base":   [p_1,...,p_7],
  "Spike":  [p_1,...,p_7],
  "Severe": [p_1,...,p_7]
},
"max_MWh_per_day": [cap_1,...,cap_7]
```

Each day in each scenario is classified as:

- Base (stable conditions)  
- Spike (moderate volatility, shortages)  
- Severe (extreme volatility or scarcity)  

Scenarios contain **technology-specific** day-type sequences:

```
scenario_day_types["Week_4"]["Oil"]  = ["Base","Spike","Base","Severe","Severe","Base","Base"]
scenario_day_types["Week_4"]["Gas"]  = [...]
scenario_day_types["Week_4"]["Coal"] = [...]
```

This enables different fuels to experience different stress conditions on the same day.

---

### 2.3 Electricity Market

Includes:

- Hourly electricity prices for each day.  
- Daily electricity price index (informative only).  
- Hourly demand arrays for each of the 168 hours.  

Hourly demand is generated by applying hourly shape factors to daily total demand.

---

### 2.4 Scenarios

Each scenario is defined by:

- A probability  
- A technology-specific series of day types (Base/Spike/Severe)  
- Fuel price realizations implied by these day types  

The same hourly demand applies to all scenarios unless extended in future versions.

---

## 3. Optimization Model

This is a **two-stage stochastic program**:

### First stage (scenario-independent)

- Daily fuel purchases  
- Total fuel available per day for each technology  

### Second stage (scenario-dependent)

- Hourly generation  
- Inventory evolution  
- Deviations from demand  
- Scenario-dependent costs  

---

## 4. Mathematical Formulation

### 4.1 Sets

- Technologies: \( t \in T \)  
- Suppliers: \( s \in S_t \)  
- Days: \( d = 1,\dots,7 \)  
- Hours: \( h = 1,\dots,24 \)  
- Scenarios: \( w \in W \)  

---

### 4.2 Decision Variables

First-stage:

\[
\text{purchase}_{t,s,d} \ge 0
\]
\[
\text{fuel\_available}_{t,d} = \sum_{s} \text{purchase}_{t,s,d}
\]

Second-stage for each scenario \( w \):

\[
\text{generate}_{t,d,h,w} \ge 0
\]
\[
\text{inventory}_{t,d,w} \ge 0
\]
\[
\text{under}_{d,h,w} \ge 0,\quad \text{over}_{d,h,w} \ge 0
\]

CVaR variables:

\[
L_w \ge 0,\quad u_w \ge 0,\quad \eta \ge 0
\]

---

### 4.3 Constraints

#### Inventory Balance

\[
\text{inventory}_{t,d,w}
=
\text{inventory}_{t,d-1,w}
+ \text{fuel\_available}_{t,d}
- \sum_h \text{generate}_{t,d,h,w}
\]

#### Generation Capacity

\[
\text{generate}_{t,d,h,w} \le \text{max\_gen}_t
\]

#### Storage Capacity

\[
\text{inventory}_{t,d,w} \le \text{storage\_cap}_t
\]

#### Supplier Limits

\[
\text{purchase}_{t,s,d} \le \text{maxOffer}_{t,s,d}
\]

#### Demand Satisfaction

\[
\sum_t \text{generate}_{t,d,h,w}
+ \text{under}_{d,h,w}
- \text{over}_{d,h,w}
= \text{demand}_{d,h}
\]

#### Zero Ending Inventory

\[
\text{inventory}_{t,7,w} = 0
\]

---

### 4.4 Profit in Scenario \( w \)

Revenue:

\[
\text{rev}_w
=
\sum_{t,d,h} 
\text{elecPrice}_{d,h} 
\cdot \text{revenueFactor}_t
\cdot \text{generate}_{t,d,h,w}
\]

Fuel cost:

\[
\text{fuelCost}_w
=
\sum_{t,s,d}
\text{purchase}_{t,s,d}
\cdot \text{fuelPrice}_{t,s,d,w}
\]

Storage cost:

\[
\text{storCost}_w
=
\sum_{t,d}
\text{storageRent}_t
\cdot \text{inventory}_{t,d,w}
\]

Deviation penalties:

\[
\text{penalty}_w
=
250 \cdot \text{under} + 150 \cdot \text{over}
\]

Profit:

\[
\text{profit}_w
= 
\text{rev}_w
- \text{fuelCost}_w
- \text{storCost}_w
- \text{penalty}_w
\]

---

## 5. CVaR Formulation

We define loss:

\[
L_w \ge 0,\quad L_w \ge \text{target} - \text{profit}_w
\]

CVaR linearization:

\[
u_w \ge L_w - \eta
\]

CVaR value:

\[
\text{CVaR}
=
\eta
+
\frac{1}{1-\alpha}
\sum_w P_w u_w
\]

Final objective:

\[
\max \left(
\sum_w P_w \cdot \text{profit}_w
-
\lambda \cdot \text{CVaR}
\right)
\]

---

## 6. Willingness-To-Pay (Endogenous Price Limit)

The dual value of:

\[
\text{fuel\_available}_{t,d}
=
\sum_s \text{purchase}_{t,s,d}
\]

yields:

\[
\text{WTP}_{t,d}
=
\text{shadowPrice}(t,d)
\]

Interpretation:

This is the maximum price the model is willing to pay for an additional MWh of fuel for technology \( t \) on day \( d \).  
It effectively acts as an optimal “elastic demand” price threshold.

---

## 7. Outputs

The notebook prints:

- Expected profit  
- CVaR value  
- VaR threshold (η)  
- Profit in every scenario  
- Worst-case scenarios  
- Fuel purchases per day and supplier  
- Technology-specific willingness-to-pay price limits  
- Loss values for each scenario  

These outputs allow evaluating:

- Sensitivity to fuel-price volatility  
- Impact of risk aversion  
- Early-week vs. late-week procurement patterns  
- Cross-technology interactions under uncertainty  

---

## 8. How to Run

1. Install dependencies:

```
pip install gurobipy numpy pandas
```

2. Ensure Gurobi license is active.

3. Place the JSON data file:

```
data/data_draft_3.json
```

4. Run the notebook:

```
Assignment_2.ipynb
```

---

## 9. Suggested Repository Structure

```
├── data/
│   ├── data_draft_1.json
│   ├── data_draft_2.json
│   └── data_draft_3.json
├── Assignment_2.ipynb
└── README.md
```

---

## 10. Potential Extensions

- Scenario-dependent electricity prices  
- Multi-week extension  
- Unit commitment constraints  
- Emissions pricing  
- Forward contracts  
- Stochastic demand  

---

## 11. Academic Relevance

The model integrates:

- Two-stage stochastic programming  
- CVaR risk adjustment  
- Technology-specific fuel volatility  
- Endogenous price thresholds via dual variables  
- Hourly electricity market modeling  
- Inventory and procurement optimization  

This framework aligns with current research in stochastic energy systems, operational planning, and risk-aware decision-making.

